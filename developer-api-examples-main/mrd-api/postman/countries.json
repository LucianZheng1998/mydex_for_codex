{
	"info": {
		"_postman_id": "fde1d991-f71c-4b9c-8496-2df2846735a2",
		"name": "Countries MRD API Examples",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "45159715"
	},
	"item": [
		{
			"name": "Countries",
			"item": [
                                {
                                        "name": "GET Countries",
                                        "event": [
                                                {
                                                        "listen": "test",
                                                        "script": {
                                                                "exec": [
                                                                        "var data = pm.response.json();",
                                                                        "",
                                                                        "pm.test(\"Status code is 200\", function() {",
                                                                        "    pm.response.to.have.status(200);",
                                                                        "});",
                                                                        "",
                                                                        "pm.test(\"Content-Type is application/json\", function() {",
                                                                        "    pm.expect(pm.response.headers.get(\"Content-Type\")).to.eql(\"application/json\");",
                                                                        "});",
                                                                        "",
                                                                        "pm.test(\"The data returns expected results\", function() {",
                                                                        "    let flat = data.flat();",
                                                                        "    let gb = flat.find(obj => obj.cca2 === 'GB');",
                                                                        "    let fr = flat.find(obj => obj.cca2 === 'FR');",
                                                                        "    pm.expect(gb.name.common).to.eql(\"United Kingdom\");",
                                                                        "    pm.expect(fr.capital[0]).to.eql(\"Paris\");",
                                                                        "});",
                                                                        ""
                                                                ],
                                                                "type": "text/javascript",
                                                                "packages": {}
                                                        }
                                                }
                                        ],
                                        "request": {
                                                "auth": {
                                                        "type": "bearer",
                                                        "bearer": [
                                                                {
                                                                        "key": "token",
                                                                        "value": "{{ACCESS_TOKEN}}",
                                                                        "type": "string"
                                                                }
                                                        ]
                                                },
                                                "method": "GET",
                                                "header": [
                                                        {
                                                                "key": "X-Mrd-Scopes",
                                                                "value": "countries",
                                                                "type": "text"
                                                        }
                                                ],
                                                "body": {},
                                                "url": {
                                                        "raw": "{{MRD_API_URL}}/countries",
                                                        "host": [
                                                                "{{MRD_API_URL}}"
                                                        ],
                                                        "path": [
                                                                "countries"
                                                        ]
                                                }
                                        },
                                        "response": []
                                },
                                {
                                        "name": "GET Specific Country",
                                        "event": [
                                                {
                                                        "listen": "test",
                                                        "script": {
                                                                "exec": [
                                                                        "var data = pm.response.json();",
                                                                        "console.log(data);",
                                                                        "",
                                                                        "pm.test(\"Status code is 200\", function() {",
                                                                        "    pm.response.to.have.status(200);",
                                                                        "});",
                                                                        "",
                                                                        "pm.test(\"Content-Type is application/json\", function() {",
                                                                        "    pm.expect(pm.response.headers.get(\"Content-Type\")).to.eql(\"application/json\");",
                                                                        "});",
                                                                        "",
                                                                        "pm.test(\"The data returns expected results\", function() {",
                                                                        "    pm.expect(data[0].name.common).to.eql(\"United Kingdom\");",
                                                                        "});",
                                                                        "",
                                                                        ""
                                                                ],
                                                                "type": "text/javascript",
                                                                "packages": {}
                                                        }
                                                }
                                        ],
                                        "request": {
                                                "auth": {
                                                        "type": "bearer",
                                                        "bearer": [
                                                                {
                                                                        "key": "token",
                                                                        "value": "{{ACCESS_TOKEN}}",
                                                                        "type": "string"
                                                                }
                                                        ]
                                                },
                                                "method": "GET",
                                                "header": [
                                                        {
                                                                "key": "X-Mrd-Scopes",
                                                                "value": "countries",
                                                                "type": "text"
                                                        }
                                                ],
                                                "body": {},
                                                "url": {
                                                        "raw": "{{MRD_API_URL}}/countries/gb",
                                                        "host": [
                                                                "{{MRD_API_URL}}"
                                                        ],
                                                        "path": [
                                                                "countries",
                                                                "gb"
                                                        ]
                                                }
                                        },
                                        "response": []
                                },
                                {
                                        "name": "GET Specific fields of specific Country using commas",
                                        "event": [
                                                {
                                                        "listen": "test",
                                                        "script": {
                                                                "exec": [
                                                                        "var data = pm.response.json();",
                                                                        "console.log(data);",
                                                                        "",
                                                                        "pm.test(\"Status code is 200\", function() {",
                                                                        "    pm.response.to.have.status(200);",
                                                                        "});",
                                                                        "",
                                                                        "pm.test(\"Content-Type is application/json\", function() {",
                                                                        "    pm.expect(pm.response.headers.get(\"Content-Type\")).to.eql(\"application/json\");",
                                                                        "});",
                                                                        "",
                                                                        "pm.test(\"The data returns expected results\", function() {",
                                                                        "    pm.expect(data.idd.root).to.eql(\"+3\");",
                                                                        "    pm.expect(data.region).to.eql(\"Europe\");",
                                                                        "    pm.expect(data.subregion).to.eql(\"Western Europe\");",
									"    pm.expect(data.startOfWeek).to.not.exist;",
                                                                        "});",
                                                                        "",
                                                                        ""
                                                                ],
                                                                "type": "text/javascript",
                                                                "packages": {}
                                                        }
                                                }
                                        ],
                                        "request": {
                                                "auth": {
                                                        "type": "bearer",
                                                        "bearer": [
                                                                {
                                                                        "key": "token",
                                                                        "value": "{{ACCESS_TOKEN}}",
                                                                        "type": "string"
                                                                }
                                                        ]
                                                },
                                                "method": "GET",
                                                "header": [
                                                        {
                                                                "key": "X-Mrd-Scopes",
                                                                "value": "countries",
                                                                "type": "text"
                                                        }
                                                ],
                                                "body": {},
                                                "url": {
                                                        "raw": "{{MRD_API_URL}}/countries/fr?filters=region,subregion,idd",
                                                        "host": [
                                                                "{{MRD_API_URL}}"
                                                        ],
                                                        "path": [
                                                                "countries",
                                                                "fr"
                                                        ],
                                                        "query": [
                                                                {
                                                                        "key": "filters",
                                                                        "value": "region,subregion,idd"
                                                                }
                                                        ]
                                                }
                                        },
                                        "response": []
                                },
                                {
                                        "name": "GET Specific fields of specific Country using arrays",
                                        "event": [
                                                {
                                                        "listen": "test",
                                                        "script": {
                                                                "exec": [
                                                                        "var data = pm.response.json();",
                                                                        "console.log(data);",
                                                                        "",
                                                                        "pm.test(\"Status code is 200\", function() {",
                                                                        "    pm.response.to.have.status(200);",
                                                                        "});",
                                                                        "",
                                                                        "pm.test(\"Content-Type is application/json\", function() {",
                                                                        "    pm.expect(pm.response.headers.get(\"Content-Type\")).to.eql(\"application/json\");",
                                                                        "});",
                                                                        "",
                                                                        "pm.test(\"The data returns expected results\", function() {",
                                                                        "    pm.expect(data.capital[0]).to.eql(\"London\");",
                                                                        "    pm.expect(data.maps.googleMaps).to.eql(\"https://goo.gl/maps/FoDtc3UKMkFsXAjHA\");",
                                                                        "});",
                                                                        "",
                                                                        ""
                                                                ],
                                                                "type": "text/javascript",
                                                                "packages": {}
                                                        }
                                                }
                                        ],
                                        "request": {
                                                "auth": {
                                                        "type": "bearer",
                                                        "bearer": [
                                                                {
                                                                        "key": "token",
                                                                        "value": "{{ACCESS_TOKEN}}",
                                                                        "type": "string"
                                                                }
                                                        ]
                                                },
                                                "method": "GET",
                                                "header": [
                                                        {
                                                                "key": "X-Mrd-Scopes",
                                                                "value": "countries",
                                                                "type": "text"
                                                        }
                                                ],
                                                "body": {},
                                                "url": {
                                                        "raw": "{{MRD_API_URL}}/countries/gb?filters[]=capital&filters[]=maps",
                                                        "host": [
                                                                "{{MRD_API_URL}}"
                                                        ],
                                                        "path": [
                                                                "countries",
                                                                "gb"
                                                        ],
                                                        "query": [
                                                                {
                                                                        "key": "filters[]",
                                                                        "value": "capital"
                                                                },
                                                                {
                                                                        "key": "filters[]",
                                                                        "value": "maps"
                                                                }
                                                        ]
                                                }
                                        },
                                        "response": []
                                },
                                {
                                        "name": "GET Specific fields of all Countries",
                                        "event": [
                                                {
                                                        "listen": "test",
                                                        "script": {
                                                                "exec": [
                                                                        "var data = pm.response.json();",
                                                                        "",
                                                                        "pm.test(\"Status code is 200\", function() {",
                                                                        "    pm.response.to.have.status(200);",
                                                                        "});",
                                                                        "",
                                                                        "pm.test(\"Content-Type is application/json\", function() {",
                                                                        "    pm.expect(pm.response.headers.get(\"Content-Type\")).to.eql(\"application/json\");",
                                                                        "});",
                                                                        "",
                                                                        "pm.test(\"The data returns expected results\", function() {",
                                                                        "    let flat= data.flat();",
                                                                        "    let gb = flat.find(obj => obj.cca2 === 'GB');",
                                                                        "    let spm = flat.find(obj => obj.cca2 === 'PM');",
                                                                        "    pm.expect(gb.car.side).to.eql(\"left\");",
                                                                        "    pm.expect(spm.car.side).to.eql(\"right\");",
									"    pm.expect(gb.capital).to.not.exist;",
                                                                        "});",
                                                                        "",
                                                                        ""
                                                                ],
                                                                "type": "text/javascript",
                                                                "packages": {}
                                                        }
                                                }
                                        ],
                                        "request": {
                                                "auth": {
                                                        "type": "bearer",
                                                        "bearer": [
                                                                {
                                                                        "key": "token",
                                                                        "value": "{{ACCESS_TOKEN}}",
                                                                        "type": "string"
                                                                }
                                                        ]
                                                },
                                                "method": "GET",
                                                "header": [
                                                        {
                                                                "key": "X-Mrd-Scopes",
                                                                "value": "countries",
                                                                "type": "text"
                                                        }
                                                ],
                                                "body": {},
                                                "url": {
                                                        "raw": "{{MRD_API_URL}}/countries?filters[]=car&filters[]=cca2",
                                                        "host": [
                                                                "{{MRD_API_URL}}"
                                                        ],
                                                        "path": [
                                                                "countries"
                                                        ],
                                                        "query": [
                                                                {
                                                                        "key": "filters[]",
                                                                        "value": "car"
                                                                },
                                                                {
                                                                        "key": "filters[]",
                                                                        "value": "cca2"
                                                                }
                                                        ]
                                                }
                                        },
                                        "response": []
                                }
                        ]
                }
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"pm.sendRequest({",
					"    url: pm.environment.get(\"OAUTH_URL\")+\"/oauth2/token\",",
					"    method: 'POST',",
					"    header: {",
					"        'Accept': 'application/json',",
					"        'Content-Type': 'application/x-www-form-urlencoded',",
					"        'Authorization': \"Basic \"+pm.environment.get(\"OAUTH_MRD_CLIENT_AUTH_BASIC\")",
					"    },",
					"    body: {",
					"        mode: 'urlencoded',",
					"        urlencoded: [",
					"            {key: 'grant_type', value: 'client_credentials'},",
					"            {key: 'scope', value: 'countries'}",
					"        ]",
					"    }",
					"},",
					"    (err, res) => {",
					"        // Set ACCESS_TOKEN",
					"        pm.variables.set(\"ACCESS_TOKEN\", res.json().access_token)",
					"});"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
                {
                        "key": "MRD_API_URL",
                        "value": "https://api-mrd.mydex.org"
                }	
	]
}
